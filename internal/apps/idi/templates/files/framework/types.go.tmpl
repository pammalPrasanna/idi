package lib

import (
	"database/sql"
	"net/http"
	"log/slog"	
{{if .IsAuth}}
	"{{.ProjectName}}/internal/lib/auth"
{{end}}
	"github.com/julienschmidt/httprouter"
)

type IApp interface {
	Sqlite3() *sql.DB
	Logger() ILogger

	Mux() *httprouter.Router
	ServeHTTP() error

	// JSON helpers
	JSON(w http.ResponseWriter, status int, data any) error
	JSONWithHeaders(w http.ResponseWriter, status int, data any, headers http.Header) error
	DecodeJSON(w http.ResponseWriter, r *http.Request, dst interface{}) error
	DecodeJSONStrict(w http.ResponseWriter, r *http.Request, dst interface{}) error

{{if .IsAuth}}
	// Auth helpers
	Hash(plaintextPassword string) (string, error)
	CompareHashAndPassword(plaintextPassword, hashedPassword string) (bool, error)
	VerifyToken(token string) (string, error)
	CreateToken(userID int) (*auth.Token, error)
	RequireAuthenticatedUser(next http.HandlerFunc) http.HandlerFunc
	GetUserById(id int) (*IUser, error)
	SetUserByIDMethod(fn func(id int) (*IUser, error))
{{end}}
	// rest helpers
	BadRequest(w http.ResponseWriter, r *http.Request, err error)         // 400
	AuthenticationRequired(w http.ResponseWriter, r *http.Request)        // 401
	InvalidAuthenticationToken(w http.ResponseWriter, r *http.Request)    // 401
	NotFound(w http.ResponseWriter, r *http.Request)                      // 404
	MethodNotAllowed(w http.ResponseWriter, r *http.Request)              // 405
	FailedValidation(w http.ResponseWriter, r *http.Request, v Validator) // 422
	ServerError(w http.ResponseWriter, r *http.Request, err error)        // 500
}

type ILogger interface {
	Debug(msg string, keysAndValues ...interface{})
	Info(msg string, keysAndValues ...interface{})
	Warn(msg string, keysAndValues ...interface{})
	Error(msg string, keysAndValues ...interface{})
	Fatal(msg string, keysAndValues ...interface{})
	Handler() slog.Handler
}

type IUser struct {
	ID int64
}
